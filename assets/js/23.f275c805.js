(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{503:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("# pipelines.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class MysqlPipeline():\n    def __init__(self, host, database, user, password, port):\n        self.host = host\n        self.database = database\n        self.user = user\n        self.password = password\n        self.port = port\n\n    @classmethod\n    def from_crawler(cls, crawler):\n        return cls(\n            host=crawler.settings.get('MYSQL_HOST'),\n            database=crawler.settings.get('MYSQL_DATABASE'),\n            user=crawler.settings.get('MYSQL_USER'),\n            password=crawler.settings.get('MYSQL_PASSWORD'),\n            port=crawler.settings.get('MYSQL_PORT'),\n        )\n\n    def open_spider(self, spider):\n        self.db = pymysql.connect(self.host, self.user, self.password, self.database, charset='utf8', port=self.port)\n        self.cursor = self.db.cursor()\n\n    def close_spider(self, spider):\n        self.db.close()\n\n    def process_item(self, item, spider):\n        data = dict(item)\n        # data['imgs'] = data['image_paths'][0]\n        # del data['image_paths']\n\n        com_id = data.get('com_id')\n        agg_time = data.get('agg_time')\n        check_sql = \"SELECT com_id FROM itjuzi WHERE com_id={} AND agg_time={}\".format(com_id, repr(agg_time))\n        count = self.cursor.execute(check_sql)\n        if count:\n            print(\"*\" * 20, \"{} {} 已存在\".format(com_id, data.get('name')))\n\n        else:\n            keys = ', '.join(data.keys())\n            values = ', '.join(['%s'] * len(data))\n            sql = 'INSERT INTO %s (%s) VALUES (%s)' % ('itjuzi', keys, values)\n            value = tuple([v for v in data.values()])\n            self.cursor.execute(sql, value)\n            self.db.commit()\n            print(\"#\" * 20, \"{} {} 储存成功\".format(com_id, data.get('name')))\n\n        return item\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);